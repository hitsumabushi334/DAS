# DAS プロジェクト - Claude Code 設定

## 目次

- [プロジェクト概要](#プロジェクト概要)
- [基本ルール](#基本ルール)
- [実装作業フロー](#実装作業フロー)
- [開発環境・ツール](#開発環境ツール)
- [プロジェクト構造](#プロジェクト構造)

## プロジェクト概要

**DAS (Dify Application Script)**

Google Apps Script（GAS）から Dify API を簡単に呼び出すためのライブラリプロジェクト
詳細は@要件定義書.md を参照

## 基本ルール

### 対話ルール

- 常に日本語で応答する
- タスク開始前に作業方針および Todo リストを作成し、このまま進めても問題ないかをユーザーに確認を取ってから作業開始すること（human-in-the-loop ツール使用）
  例:
  作業方針:｢作業方針｣
  Todo 1. "具体的な作業 1" 2. "具体的な作業 2" 3. "具体的な作業 3"

- 不明な点があればユーザーに確認する（human-in-the-loop ツール使用）
- 必要に応じて Web 検索を活用する
- @要件定義書.md 及び@タスクリスト.md に従って実装すること
- api リファレンスとして@dify-api を参照すること
- 私が出す指示は必ずしも行なわなければ行けないとは限らない。指示された場合、現在の状況から作業を行う必要があるのか論理的に判断してから作業すること。

### 開発原則

1. **YAGNI**: 将来使うかも知れない機能は実装しない
2. **DRY**: 重複コードは必ず関数化、モジュール化する
3. **KISS**: 複雑な解決策よりシンプルな解決策を優先
4. 指示されたこと以外の作業は行なわず、余計なものを実装しない。

### 作業報告規則

作業完了時は、以下の形式で作業内容の要約を必ずユーザーに報告してください：

```
---
作業完了報告:

1. [実施した作業項目1]
2. [実施した作業項目2]
3. [実施した作業項目3]
...
---

```

## 実装作業フロー

以下の作業で作成したファイルはすべて/spec ディレクトリに格納すること。

1. 要件定義（目的・機能・制約を明確化）(要件定義書.md)
2. 設計 (要件定義を基にアーキテクチャ、コンポーネント、インターフェース、データモデル、エラーハンドリングの観点で設計)(設計書.md)
3. 作業計画（実装する際のタスクリスト、手順・ファイル・テスト方法を明確化）(タスクリスト.md)

### タスクリスト作成ルール

次のルールに従ってタスクリストを作成すること

1.  機能実装のプロセスを、大きなタスク（例：API 設計、バックエンド実装、フロントエンド実装、テスト、デプロイなど）に分割してください。
2.  各大きなタスクの中に、具体的なサブタスクを複数作成してください。
3.  各サブタスクには、そのタスクを完了するための「要件」と、修正・作成する可能性のある「ファイル」を明記してください。
4.  必ず、以下の `#出力フォーマット・テンプレート` に厳密に従って出力してください。インデント（字下げ）や記号も完全に一致させてください。
5.  全てのチェックボックスは未完了の `[ ]` で開始してください。

### 要件定義テンプレート

```
- 概要
- 要件
   - 要件1
      - ユーザーストーリー
      - Acceptance Criteria
   - 要件2
   …
   - 要件N
…
```

### 設計書テンプレート

```
### 1. システムアーキテクチャ
**全体構成:**
- アーキテクチャパターン（MVC、マイクロサービス等）
- 主要レイヤーとその責務
- 技術スタック選定理由

**図解:** テキストベースの構成図またはmermaid記法

### 2. コンポーネント設計
**主要コンポーネント一覧:**
各コンポーネントについて：
- 名称と目的
- 主要機能
- 他コンポーネントとの依存関係
- 設計パターンの適用

### 3. インターフェース仕様
**外部インターフェース:**
- API仕様（エンドポイント、パラメータ、レスポンス）
- プロトコル選定理由

**内部インターフェース:**
- コンポーネント間通信方式
- データ交換フォーマット

### 4. データモデル設計
**エンティティ設計:**
- 主要エンティティとその属性
- エンティティ関係図（ER図のテキスト表現）
- データ整合性制約

**データフロー:**
- 主要なデータの流れ
- 永続化方式

### 5. エラーハンドリング戦略
**エラー分類:**
- システムエラー、ビジネスエラー、バリデーションエラー
- 各エラーの対処方針

**実装方針:**
- 例外処理パターン
- ログ出力方針
- ユーザーへの通知方式
- 復旧手順

## 制約条件
- 保守性、拡張性を重視した設計にする
- 各観点の相互関係を明確にする
- 実装難易度も考慮した現実的な設計にする
```

### 作業計画テンプレート

```
## [ ] タスク1: [機能概要]
[x] 1. [具体的なタスク内容]
   - 要件：[満たす要件]
   - ファイル：[対象ファイル]
[ ] 2. [具体的なタスク内容]
   - 要件：[満たす要件]
   - ファイル：[対象ファイル]
...

## [ ] タスク2: [次の機能]
...
```

### コードレビュー規則

コードレビューの依頼がされた場合、必ず日本語でレビューすること

### 開発コマンド

```bash
clasp push    # Google Cloudに反映
clasp pull    # Cloudから取得
clasp open    # Apps Scriptエディタで開く
clasp create [scriptTitle] # 新しい Apps Script プロジェクトを作成する
```
